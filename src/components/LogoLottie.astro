---
interface Props {
  src: string; // Path to JSON (e.g. "/assets/anim.json")
  loop?: boolean;
  autoplay?: boolean;
  class?: string;
}

const {
  src,
  loop = true,
  autoplay = true,
  class: className = "w-full h-full",
} = Astro.props;
---

<div
  class:list={["lottie-player", className]}
  data-src={src}
  data-loop={loop.toString()}
  data-autoplay={autoplay.toString()}
>
</div>

<script>
  import lottie from "lottie-web";

  const initLottie = () => {
    const containers = document.querySelectorAll(".lottie-player");

    containers.forEach((container) => {
      // Avoid re-initializing if already loaded
      if (container.getAttribute("data-loaded") === "true") return;

      lottie.loadAnimation({
        container: container as HTMLElement,
        renderer: "svg",
        loop: container.getAttribute("data-loop") === "true",
        autoplay: container.getAttribute("data-autoplay") === "true",
        path: container.getAttribute("data-src") || "", // Load from URL
        rendererSettings: {
          preserveAspectRatio: "xMidYMid meet",
        },
      });

      container.setAttribute("data-loaded", "true");
    });
  };

  // Run on load
  initLottie();

  // Re-run on Astro page swaps (if ViewTransitions are used)
  document.addEventListener("astro:page-load", initLottie);
</script>
