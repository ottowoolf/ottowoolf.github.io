---
interface Props {
  src: string; // Path to JSON (e.g. "/assets/anim.json")
  loop?: boolean;
  autoplay?: boolean;
  class?: string;
  href?: string; // Optional: Add URL prop
}

const {
  src,
  loop = true,
  autoplay = true,
  class: className = "w-full h-full",
  href,
} = Astro.props;
---

<!-- Conditional Rendering: If 'href' exists, render link wrapper -->{
  href ? (
    <a href={href} class:list={["block", className]}>
      <div
        class="lottie-player w-full h-full"
        data-src={src}
        data-loop={loop.toString()}
        data-autoplay={autoplay.toString()}
      />
    </a>
  ) : (
    <div
      class:list={["lottie-player", className]}
      data-src={src}
      data-loop={loop.toString()}
      data-autoplay={autoplay.toString()}
    />
  )
}

<script>
  import lottie from "lottie-web";

  const initLottie = () => {
    const containers = document.querySelectorAll(".lottie-player");

    containers.forEach((container) => {
      if (container.getAttribute("data-loaded") === "true") return;

      lottie.loadAnimation({
        container: container as HTMLElement,
        renderer: "svg",
        loop: container.getAttribute("data-loop") === "true",
        autoplay: container.getAttribute("data-autoplay") === "true",
        path: container.getAttribute("data-src") || "",
        rendererSettings: {
          preserveAspectRatio: "xMidYMid meet",
        },
      });

      container.setAttribute("data-loaded", "true");
    });
  };

  initLottie();
  document.addEventListener("astro:page-load", initLottie);
</script>
